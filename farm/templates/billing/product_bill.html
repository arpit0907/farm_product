{% load static %}
{% load custome %}
<!DOCTYPE html>
<html>
<head>
    <title>Farm</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- toster jsvs script-->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
    <!-- End toster jsvs script-->

</head>
<body>

<div id="invoice">
<div class="toolbar hidden-print">
    <div class="text-right">
        <button id="printInvoice" class="btn btn-info"><i class="fa fa-print"></i> Print</button>
    </div>
    <hr>
</div>
<div class="container">
    <div class="card-header">
        Invoice
        <strong>{% today_days %}</strong> 

    </div>
    <div class="card-body">
    <div class="row mb-4">
    <div class="col-sm-6">
    <h6 class="mb-3">From:</h6>
    <div>
    <strong>Webz Poland</strong>
    </div>
    <div>Madalinskiego 8</div>
    <div>71-101 Szczecin, Poland</div>
    <div>Email: info@webz.com.pl</div>
    <div>Phone: +48 444 666 3333</div>
    </div>

    </div>
    <div class="card-header">
        
        <strong>Customer Information</strong> 
          {# <span class="float-right"> <strong>Status:</strong> Pending</span> #}

          {% if error %}
          <script type="text/javascript">toastr.error('{{ error|escape }}', 'Message', {timeOut: 5000});</script>
          {%endif%}
    </div>
<br>
<form method="POST">
    {% csrf_token %}
    {% if form.errors %}
          {% for field in form %}
            {% for error in field.errors %}
              <!--<div class="alert alert-danger">
                <strong>{{ field.label }} : {{ error|escape }}</strong>
              </div>-->
                <!-- Added toster -->
                <script type="text/javascript">toastr.error('{{ error|escape }}', '{{field.label}}', {timeOut: 5000});</script>

            {% endfor %}
          {% endfor %}
          {% for error in form.non_field_errors %}
              <!--<div class="alert alert-danger">
                <strong>{{ error|escape }}</strong>
            </div>-->
            <script type="text/javascript">toastr.error('{{ error|escape }}', '{{field.label}}', {timeOut: 5000});</script>
          {% endfor %}
      {% endif %} 
<div class="row">
<div class="col-sm-6">
    <label for="male">Custome Name</label>
    <input type="text" name='customer_name' placeholder='0.00' class="form-control">
</div>
<div class="col-sm-6">
    <label for="male">Customer Address</label>
    <input type="text" name='customer_address' placeholder='0.00' class="form-control">
</div>
<div class="col-sm-6">
    <label for="male">Customer Number</label>
    <input type="text" name='customer_number' placeholder='0.00' class="form-control">
</div>

</div>


<br>

    <div class="table-responsive-sm">
                          <table class="table table-striped" id="tab_logic">
                            <thead>
                              <tr>
                                <th class="text-center"> # </th>
                                <th class="text-center"> Product </th>
                                <th class="text-center"> Qty </th>
                                <th class="text-center"> Price </th>
                                <th class="text-center"> Total </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr id='addr0'>
                                <td>1</td>
                                {% get_poducts as product_list %}
                                <td>
                                    <select name="product_list" id="cars" class="form-control">
                                    {% for product in product_list %}
                                      <option value="{{product}}">{{product}}</option>
                                    {% endfor %}
                                    </select>
                                </td>
                                <!--<td><input type="text" name='product[]'  placeholder='Enter Product Name' class="form-control"/></td>-->
                                <td ><input type="number" name='qty_list' placeholder='Enter Qty' class="form-control qty" step="0" min="0"/></td>
                                <td><input type="number" name='unit_price_list' placeholder='Enter Unit Price' class="form-control price" step="0.00" min="0"/></td>
                                <td><input type="number" name='total_list' placeholder='0.00' class="form-control total" readonly/></td>
                              </tr>
                              <tr id='addr1'></tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <div class="row clearfix">
                        <div class="col-md-12">
                          <button id="add_row" type="button" class="btn btn-default pull-left">Add Row</button>
                          <button id='delete_row' type="button" class="pull-right btn btn-default">Delete Row</button>
                        </div>
                      </div>
                      <div class="row clearfix" style="margin-top:20px">
                        <div class="col-lg-4 col-sm-5 ml-auto">
                          <table class="table table-clear" id="tab_logic_total">
                            <tbody>
                              <tr>
                                <th class="text-center">Sub Total</th>
                                <td class="text-center"><input type="number" name='sub_amount' placeholder='0.00' class="form-control" id="sub_total" readonly/></td>
                              </tr>
                              <tr>
                                <th class="text-center">CGST</th>
                                <td class="text-center"><div class="input-group mb-2 mb-sm-0">
                                    <input type="number" class="form-control" id="tax" placeholder="0">
                                    <div class="input-group-addon">%</div>
                                  </div></td>
                              </tr>
                              <tr>
                                <th class="text-center">CGST Tax Amount</th>
                                <td class="text-center"><input type="number" name='tax_amount' id="tax_amount" placeholder='0.00' class="form-control" readonly/></td>
                              </tr>
                              <tr>
                                <th class="text-center">Grand Total</th>
                                <td class="text-center"><input type="number" name='total_amount' id="total_amount" placeholder='0.00' class="form-control" readonly/></td>
                              </tr>
                            </tbody>
                          </table>

                        </div>
</div>
    </div>
    </div>
    <button type="submit">Submit</button>
    </form> 

</body>
<script type="text/javascript">
 $('#printInvoice').click(function(){
            Popup($('.invoice'));
            function Popup(data) 
            {
                window.print();
                return true;
            }
        });
$(document).ready(function(){
    var i=1;
    $("#add_row").click(function(){b=i-1;
        $('#addr'+i).html($('#addr'+b).html()).find('td:first-child').html(i+1);
        $('#tab_logic').append('<tr id="addr'+(i+1)+'"></tr>');
        i++; 
    });
    $("#delete_row").click(function(){
        if(i>1){
        $("#addr"+(i-1)).html('');
        i--;
        }
        calc();
    });
    
    $('#tab_logic tbody').on('keyup change',function(){
        calc();
    });
    $('#tax').on('keyup change',function(){
        calc_total();
    });
    

});

function calc()
{
    $('#tab_logic tbody tr').each(function(i, element) {
        var html = $(this).html();
        if(html!='')
        {
            var qty = $(this).find('.qty').val();
            var price = $(this).find('.price').val();
            $(this).find('.total').val(qty*price);
            
            calc_total();
        }
    });
}

function calc_total()
{
    total=0;
    $('.total').each(function() {
        total += parseInt($(this).val());
    });
    $('#sub_total').val(total.toFixed(2));
    tax_sum=total/100*$('#tax').val();
    $('#tax_amount').val(tax_sum.toFixed(2));
    $('#total_amount').val((tax_sum+total).toFixed(2));
}
</script>
</html>

